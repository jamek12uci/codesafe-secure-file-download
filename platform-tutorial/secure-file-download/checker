#!/usr/bin/env python3
import json
import sys

def fail(msg):
    print(f"[FAIL] {msg}")
    sys.exit(1)

def pass_test(msg):
    print(f"[PASS] {msg}")

try:
    from modify_me import FileDownloadService
except ImportError:
    fail("Could not import modify_me")

# Test valid file behavior
try:
    service = FileDownloadService()
    result = service.download_file("example.txt")
    data = json.loads(result)
    assert "contents" in data
    pass_test("Valid file download works")
except Exception:
    fail("Valid file download failed")

# Test directory traversal exploit
try:
    service.download_file("../flag")
    fail("Directory traversal vulnerability still exists")
except Exception:
    pass_test("Directory traversal blocked")

# Print flag if all tests pass
with open("/flag", "r") as f:
    print("\nFLAG:")
    print(f.read())
